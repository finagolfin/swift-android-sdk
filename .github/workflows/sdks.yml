name: SDKs
on:
  pull_request:
  schedule:
    - cron: '0 9 * * *'
jobs:
  get-latest-toolchain:
    runs-on: ubuntu-20.04
    steps:
      - name: Get cached clang toolchain
        id: cache-toolchain
        uses: actions/cache@v3
        with:
          path: ~/clang+llvm-16.0.0-x86_64-linux-gnu-ubuntu-18.04.tar.xz
          key: clang-16-toolchain
      - name: Get latest clang toolchain if not cached
        if: ${{ steps.cache-toolchain.outputs.cache-hit != 'true' }}
        run: |
          cd
          wget -q https://github.com/llvm/llvm-project/releases/download/llvmorg-16.0.0/clang+llvm-16.0.0-x86_64-linux-gnu-ubuntu-18.04.tar.xz
      - name: Get Swift NIO package
        uses: actions/checkout@v3
        with:
          repository: apple/swift-nio
          path: swift-nio
      - name: Build Swift Argument Parser package
        run: |
          cd swift-nio
          tar xf ~/clang+llvm-16.0.0-x86_64-linux-gnu-ubuntu-18.04.tar.xz
          ./clang+llvm-16.0.0-x86_64-linux-gnu-ubuntu-18.04/bin/ld.lld --version
          linker=`pwd`/clang+llvm-16.0.0-x86_64-linux-gnu-ubuntu-18.04/bin/ld.lld
          for i in {1..10}
          do
          swift package clean
          swift build --build-tests --enable-test-discovery -v -Xswiftc -use-ld=$linker
          done
